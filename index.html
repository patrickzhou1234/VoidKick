<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Block Battle Arena</title>
    <link href="https://cdn.muicss.com/mui-0.10.3/css/mui.min.css" rel="stylesheet" type="text/css" />
    <link href="style.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="babylon.js"></script>
    <script src="babylonjs.loaders.min.js"></script>
    <script src="ammo.js"></script>
  </head>
  <body>
    <div id="menuselections" class="mui-panel">
      <div class="mui-form--inline">
        <div class="menu-item">
          <input name="colorpicker" id="colorpicker" type="color" value="#FF0000">
          <label for="colorpicker">Color</label>
        </div>
        
        <div class="menu-item">
          <div class="mui-checkbox">
            <label>
              <input id="frontfacingvis" type="checkbox" name="frontfacingvis" checked>
              Show Spawn
            </label>
          </div>
        </div>
        
        <div class="menu-item">
          <div class="mui-select">
            <select id="meshtype" name="meshtype">
              <option value="box">Box</option>
              <option value="sphere">Sphere</option>
              <option value="cylinder">Cylinder</option>
              <option value="capsule">Capsule</option>
              <option value="mine">Mine</option>
            </select>
            <label>Mesh Type</label>
          </div>
        </div>
        
        <div class="menu-item">
          <div class="mui-checkbox">
            <label>
              <input id="slimyToggle" type="checkbox" name="slimyToggle">
              Slimy
            </label>
          </div>
        </div>
        
        <div class="menu-item slider-item">
          <label for="sizeToggle">Size</label>
          <input id="sizeToggle" type="range" min="0" max="100" value="50">
        </div>
        
        <div class="menu-item">
          <button id="clearBtn" class="mui-btn mui-btn--danger mui-btn--small">Clear All</button>
        </div>
        
        <div class="menu-item">
          <a href="/admin.html" target="_blank" class="mui-btn mui-btn--primary mui-btn--small">Admin</a>
        </div>
      </div>
    </div>
    <button id="menureveal" class="mui-btn mui-btn--accent">‚áß</button>
    
    <!-- Settings button at bottom left -->
    <div id="settingsContainer" style="position:fixed; bottom:20px; left:20px; z-index:1500;">
      <button id="settingsBtn" class="mui-btn mui-btn--raised mui-btn--primary" style="border-radius:50%; width:56px; height:56px; font-size:24px; box-shadow:0 4px 12px rgba(0,0,0,0.5); display:flex; align-items:center; justify-content:center; padding:0; min-width:56px;">‚öôÔ∏è</button>
      <div id="settingsMenu" style="display:none; position:absolute; bottom:70px; left:0; background:rgba(0,0,0,0.95); border-radius:8px; padding:10px; min-width:200px; backdrop-filter:blur(10px); border:2px solid rgba(74,144,217,0.5); box-shadow:0 4px 20px rgba(0,0,0,0.7);">
        <button id="browseRoomsBtn" class="mui-btn mui-btn--accent mui-btn--raised" style="width:100%; margin-bottom:8px;">üéÆ Browse Rooms</button>
        <button id="joinPrivateRoomBtn" class="mui-btn mui-btn--raised" style="width:100%; margin-bottom:8px; background-color:#9c27b0 !important;">üîí Join Private Room</button>
        <button id="toggleThirdPersonBtn" class="mui-btn mui-btn--raised" style="width:100%;">üì∑ Toggle Camera</button>
      </div>
    </div>
    
    <!-- Private room code overlay -->
    <div id="privateRoomOverlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:2600; justify-content:center; align-items:center; flex-direction:column;">
      <div style="background:rgba(255,255,255,0.05); padding:40px; border-radius:15px; border:2px solid rgba(74,144,217,0.5); text-align:center;">
        <div style="color:white; font-size:32px; margin-bottom:15px;">üîí Join Private Room</div>
        <div style="color:#888; font-size:16px; margin-bottom:25px;">Enter the room code</div>
        <input type="text" id="privateRoomCodeInput" class="mui-textfield" style="font-size:18px; padding:12px 20px; margin-bottom:20px; width:300px; max-width:90%; text-align:center; letter-spacing:2px; text-transform:uppercase;" placeholder="ROOM-CODE" maxlength="20">
        <div style="display:flex; gap:10px; justify-content:center;">
          <button id="joinPrivateRoomSubmit" class="mui-btn mui-btn--primary mui-btn--raised mui-btn--large">Join</button>
          <button id="closePrivateRoomOverlay" class="mui-btn mui-btn--raised mui-btn--large">Cancel</button>
        </div>
      </div>
    </div>
    
    <!-- Room selector overlay -->
    <div id="roomSelectorOverlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:2500; overflow-y:auto; padding:40px 20px;">
      <div style="max-width:800px; margin:0 auto;">
        <div style="color:white; font-size:36px; margin-bottom:10px; text-align:center;">üéÆ Select a Room</div>
        <div id="currentRoomDisplay" style="color:#4a90d9; font-size:16px; margin-bottom:15px; text-align:center;"></div>
        <div style="color:#888; font-size:16px; margin-bottom:30px; text-align:center;">Choose a room to join</div>
        <div id="roomsList" style="display:grid; grid-template-columns:repeat(auto-fill, minmax(300px, 1fr)); gap:20px; margin-bottom:30px;">
          <!-- Rooms will be populated here -->
        </div>
        <div style="text-align:center; padding-bottom:20px;">
          <button id="closeRoomSelector" class="mui-btn mui-btn--accent mui-btn--raised mui-btn--large">Close</button>
        </div>
      </div>
    </div>
    
    <div id="usernameOverlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:2000; display:flex; justify-content:center; align-items:center; flex-direction:column;">
      <div style="color:white; font-size:40px; margin-bottom:10px;">üéÆ Block Battle Arena</div>
      <div id="welcomeMessage" style="color:#4a90d9; font-size:24px; margin-bottom:30px;">Loading...</div>
      <input type="text" id="usernameInput" class="mui-textfield" style="font-size:20px; padding:10px; margin-bottom:20px; width:300px; max-width:90%; text-align:center;" placeholder="Username" maxlength="15" disabled>
      <button id="startGameBtn" class="mui-btn mui-btn--primary mui-btn--raised mui-btn--large">Play Now!</button>
      <div style="margin-top:20px; display:flex; gap:10px;">
        <a href="/leaderboard" target="_blank" class="mui-btn mui-btn--accent mui-btn--raised">üèÜ Leaderboard</a>
        <button id="viewProfileBtn" class="mui-btn mui-btn--raised" style="display:none;">üë§ My Profile</button>
      </div>
    </div>
    <div id="killFeed" style="position:fixed; top:20px; right:20px; text-align:right; z-index:1500; pointer-events:none;"></div>
    
    <div id="killAnimation" style="display:none; position:fixed; top:150px; left:50%; transform:translateX(-50%); font-size:40px; color:#ff3333; font-weight:bold; text-shadow:2px 2px 4px black; z-index:1500; animation: popIn 0.5s ease-out;">
        KILLED <span id="killedName">PLAYER</span>
    </div>

    <div id="deathOverlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(139,0,0,0.7); z-index:1000; justify-content:center; align-items:center; flex-direction:column;">
      <div style="color:white; font-size:80px; font-weight:bold; text-shadow: 4px 4px 8px black;">YOU DIED!</div>
      <div id="causeOfDeath" style="color:#ffcccc; font-size:24px; margin-top:10px;"></div>
      <div id="killerInfo" style="color:white; font-size:30px; margin-top:10px;"></div>
      <div id="respawnTimer" style="color:white; font-size:30px; margin-top:20px;">Respawning in 5...</div>
    </div>
    <!-- Ultimate charge bar -->
    <div id="ultimateContainer" style="display:none; position:fixed; bottom:50px; left:50%; transform:translateX(-50%); z-index:500; text-align:center;">
      <div style="color:white; font-size:18px; font-weight:bold; text-shadow: 2px 2px 4px black; margin-bottom:5px;">CHARGING ULTIMATE...</div>
      <div style="width:300px; height:20px; background:rgba(0,0,0,0.7); border:2px solid #fff; border-radius:10px; overflow:hidden;">
        <div id="ultimateBar" style="width:0%; height:100%; background:linear-gradient(90deg, #ff6600, #ffcc00, #ff0000); transition:width 0.1s;"></div>
      </div>
    </div>
    <!-- Grenade charge bar -->
    <div id="grenadeContainer" style="display:none; position:fixed; bottom:90px; left:50%; transform:translateX(-50%); z-index:500; text-align:center;">
      <div style="color:white; font-size:18px; font-weight:bold; text-shadow: 2px 2px 4px black; margin-bottom:5px;">CHARGING GRENADE...</div>
      <div style="width:300px; height:20px; background:rgba(0,0,0,0.7); border:2px solid #0f0; border-radius:10px; overflow:hidden;">
        <div id="grenadeBar" style="width:0%; height:100%; background:linear-gradient(90deg, #00ff00, #88ff00, #00ff00); transition:width 0.1s;"></div>
      </div>
    </div>
    <!-- Drone charge bar -->
    <div id="droneContainer" style="display:none; position:fixed; bottom:130px; left:50%; transform:translateX(-50%); z-index:500; text-align:center;">
      <div style="color:white; font-size:18px; font-weight:bold; text-shadow: 2px 2px 4px black; margin-bottom:5px;">LAUNCHING DRONE...</div>
      <div style="width:300px; height:20px; background:rgba(0,0,0,0.7); border:2px solid #00ffff; border-radius:10px; overflow:hidden;">
        <div id="droneBar" style="width:0%; height:100%; background:linear-gradient(90deg, #00ffff, #0088ff, #00ffff); transition:width 0.1s;"></div>
      </div>
    </div>
    <!-- Drone mode indicator -->
    <div id="droneModeIndicator" style="display:none; position:fixed; top:20px; left:50%; transform:translateX(-50%); z-index:500; background:rgba(0,0,0,0.7); padding:10px 20px; border-radius:10px; border:2px solid #00ffff;">
      <div style="color:#00ffff; font-size:20px; font-weight:bold;">DRONE MODE - Click to drop bomb, P to exit</div>
    </div>
    <!-- Loading screen -->
    <div id="loadingScreen" style="position:fixed; top:0; left:0; width:100%; height:100%; background:linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #0a0a0a 100%); z-index:3000; display:flex; justify-content:center; align-items:center; flex-direction:column;">
      <div style="text-align:center;">
        <div class="loading-icon" style="font-size:60px; margin-bottom:20px; animation: pulse 1.5s ease-in-out infinite;">üéÆ</div>
        <div style="color:white; font-size:36px; font-weight:bold; margin-bottom:10px; text-shadow: 0 0 20px rgba(74,144,217,0.5);">Block Battle Arena</div>
        <div id="loadingText" style="color:#4a90d9; font-size:18px; margin-bottom:30px;">Initializing...</div>
        <div style="width:300px; height:8px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden; margin-bottom:15px; box-shadow: 0 0 10px rgba(0,0,0,0.5);">
          <div id="loadingBar" style="width:0%; height:100%; background:linear-gradient(90deg, #4a90d9, #00ffff, #4a90d9); background-size: 200% 100%; animation: shimmer 1.5s linear infinite; transition:width 0.3s ease; border-radius:4px;"></div>
        </div>
        <div id="loadingPercent" style="color:#888; font-size:14px;">0%</div>
        <div style="color:#555; font-size:12px; margin-top:20px;">Loading 3D models...</div>
      </div>
    </div>
    <style>
      @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
      }
      @keyframes shimmer {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
      }
    </style>
    <canvas id="babcanv"></canvas>
    <script src="https://cdn.muicss.com/mui-0.10.3/js/mui.min.js"></script>
    <script src="script.js"></script>
  </body>
</html>
